import{a as s}from"./api.DUBSwrnZ.js";import"./hoisted.DbckvgP9.js";async function g(){try{const t=await s.getProfile();console.log("Profile loaded:",t);const r=document.getElementById("header-name"),e=document.getElementById("header-email");r&&(r.innerText=t.name),e&&(e.innerText=t.email);const n="http://localhost:3000",a=document.getElementById("avatar-img"),o=document.getElementById("cover-img"),i=Date.now();t.profileImage?a.src=`${n}${t.profileImage}?t=${i}`:a.src=`https://ui-avatars.com/api/?name=${t.name}&background=random`,t.coverImage&&(o.src=`${n}${t.coverImage}?t=${i}`,o.classList.remove("hidden")),localStorage.setItem("user",JSON.stringify(t)),window.dispatchEvent(new CustomEvent("user-updated")),document.getElementById("name").value=t.name,document.getElementById("email").value=t.email,l(t.entrepreneurships)}catch(t){console.error("Error loading profile:",t)}}const m=document.getElementById("profile-form");m?.addEventListener("submit",async t=>{t.preventDefault();const r=m.querySelector("button[type=submit]"),e=r.innerText;r.disabled=!0,r.innerText="Guardando...";try{const n=new FormData(m);await s.updateProfile({name:n.get("name")});const a=JSON.parse(localStorage.getItem("user")||"{}");a.name=n.get("name"),a.id=a.id,localStorage.setItem("user",JSON.stringify({...a,name:n.get("name")})),alert("Perfil actualizado correctamente")}catch(n){console.error(n),alert("Error al actualizar perfil")}finally{r.disabled=!1,r.innerText=e}});const u=document.getElementById("password-form");u?.addEventListener("submit",async t=>{t.preventDefault();const r=u.querySelector("button[type=submit]"),e=r.innerText,n=document.getElementById("currentPassword").value,a=document.getElementById("newPassword").value,o=document.getElementById("confirmPassword").value;if(a!==o){alert("Las nuevas contraseñas no coinciden");return}r.disabled=!0,r.innerText="Actualizando...";try{await s.changePassword({currentPassword:n,newPassword:a}),alert("Contraseña actualizada correctamente"),u.reset()}catch(i){console.error(i),alert(i.message||"Error al actualizar la contraseña")}finally{r.disabled=!1,r.innerText=e}});function l(t){const r=document.getElementById("entrepreneurships-list");if(r){if(!t||t.length===0){r.innerHTML='<p class="text-slate-500 text-center py-4">No tienes emprendimientos registrados.</p>';return}r.innerHTML=t.map(e=>{const n=e.logoUrl||e.imageUrl||e.logo||e.image,a="http://localhost:3000";let o=null;return n&&typeof n=="string"&&n.trim()!==""&&(o=n.startsWith("http")?n:`${a}${n.startsWith("/")?"":"/"}${n}`),`
                    <div class="border border-slate-200 rounded-xl p-4 hover:shadow-lg transition-all bg-white flex flex-col md:flex-row md:items-center group">
                        <div class="flex items-center flex-1">
                            ${o?`<img src="${o}" class="w-12 h-12 rounded-lg object-cover mr-4" />`:'<div class="w-12 h-12 rounded-lg bg-slate-100 flex items-center justify-center mr-4"><svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}
                            <div>
                                <h3 class="font-bold text-slate-800">${e.name}</h3>
                                <p class="text-sm text-slate-500">${e.sector}</p>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4 md:mt-0 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                            <button 
                                class="btn-edit-ent btn btn-secondary btn-sm p-2"
                                data-id="${e.id}"
                                title="Editar Emprendimiento"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                            </button>
                            <button 
                                class="btn-image-ent btn btn-outline btn-sm p-2"
                                data-id="${e.id}"
                                title="Cambiar Imagen"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            </button>
                            <button 
                                class="btn-delete-ent btn btn-danger btn-sm bg-red-50 text-red-600 border-red-100 hover:bg-red-600 hover:text-white"
                                data-id="${e.id}"
                                data-name="${e.name}"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                `}).join(""),document.querySelectorAll(".btn-delete-ent").forEach(e=>{e.addEventListener("click",async n=>{const o=n.currentTarget.dataset.id;b("delete-entrepreneurship",o)})}),document.querySelectorAll(".btn-edit-ent").forEach(e=>{e.addEventListener("click",async n=>{const o=n.currentTarget.dataset.id;try{const i=await s.getEntrepreneurship(parseInt(o));window.dispatchEvent(new CustomEvent("open-entrepreneurship-wizard",{detail:{mode:"edit",data:i}}))}catch{alert("Error al cargar datos del emprendimiento")}})}),document.querySelectorAll(".btn-image-ent").forEach(e=>{e.addEventListener("click",n=>{const a=n.currentTarget.dataset.id,o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=async i=>{const p=i.target.files[0];if(p)try{await s.uploadImage(`/entrepreneurships/${a}/image`,p);const v=await s.getProfile();l(v.entrepreneurships)}catch{alert("Error al subir imagen")}},o.click()})})}}const d=document.getElementById("security_confirm_modal"),w=document.getElementById("security-confirm-form"),y=document.getElementById("security-password"),h=document.getElementById("security-error"),c=document.getElementById("security-submit-btn");function b(t,r){document.getElementById("security-action-type").value=t,document.getElementById("security-target-id").value=r,y.value="",h?.classList.add("hidden"),d.showModal()}w?.addEventListener("submit",async t=>{t.preventDefault();const r=document.getElementById("security-action-type").value,e=document.getElementById("security-target-id").value,n=y.value;c&&(c.innerHTML='<span class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>',c.disabled=!0);try{if(await s.verifyPassword(n),r==="delete-entrepreneurship"){await s.deleteEntrepreneurship(parseInt(e));const a=await s.getProfile();l(a.entrepreneurships)}d.close()}catch(a){console.error(a),h?.classList.remove("hidden")}finally{c&&(c.innerHTML="<span>Confirmar y Eliminar</span>",c.disabled=!1)}});document.getElementById("security-cancel-btn")?.addEventListener("click",()=>d.close());document.getElementById("btn-close-security-modal")?.addEventListener("click",()=>d.close());const I=document.getElementById("btn-new-entrepreneurship");I?.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("open-entrepreneurship-wizard",{detail:{mode:"create"}}))});window.addEventListener("entrepreneurship-success",async()=>{const t=await s.getProfile();l(t.entrepreneurships)});const B=document.getElementById("avatar-container"),f=document.getElementById("avatar-input"),L=document.getElementById("cover-container"),E=document.getElementById("cover-input");B?.addEventListener("click",()=>f.click());L?.addEventListener("click",()=>E.click());f?.addEventListener("change",async t=>{const r=t.target.files[0];if(r){console.log("Uploading avatar...",r.name);try{const e=await s.uploadImage("/users/me/images",r,{type:"profile"});console.log("Avatar upload success:",e),g()}catch(e){console.error("Avatar upload failed:",e),alert("Error al subir avatar")}}});E?.addEventListener("change",async t=>{const r=t.target.files[0];if(r){console.log("Uploading cover...",r.name);try{const e=await s.uploadImage("/users/me/images",r,{type:"cover"});console.log("Cover upload success:",e),g()}catch(e){console.error("Cover upload failed:",e),alert("Error al subir portada")}}});g();
