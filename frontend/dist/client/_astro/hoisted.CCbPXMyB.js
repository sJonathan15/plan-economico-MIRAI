import{api as i}from"./api.CPfjwQVw.js";import"./hoisted.Qv3mm9Uz.js";import"./Sidebar.astro_astro_type_script_index_0_lang.DZqaJy4g.js";async function y(){try{const e=await i.getProfile();console.log("Profile loaded:",e);const r=document.getElementById("header-name"),t=document.getElementById("header-email");r&&(r.innerText=e.name),t&&(t.innerText=e.email);const n="http://localhost:3000",o=document.getElementById("avatar-img"),a=document.getElementById("cover-img"),s=Date.now();e.profileImage?o.src=`${n}${e.profileImage}?t=${s}`:o.src=`https://ui-avatars.com/api/?name=${e.name}&background=random`,e.coverImage&&(a.src=`${n}${e.coverImage}?t=${s}`,a.classList.remove("hidden")),(!!localStorage.getItem("token")?localStorage:sessionStorage).setItem("user",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("user-updated")),document.getElementById("name").value=e.name,document.getElementById("email").value=e.email,d(e.entrepreneurships)}catch(e){console.error("Error loading profile:",e)}}const p=document.getElementById("profile-form");p?.addEventListener("submit",async e=>{e.preventDefault();const r=p.querySelector("button[type=submit]"),t=r.innerText;r.disabled=!0,r.innerText="Guardando...";try{const n=new FormData(p);await i.updateProfile({name:n.get("name")});const a=!!localStorage.getItem("token")?localStorage:sessionStorage,s=i.getUser()||{};a.setItem("user",JSON.stringify({...s,name:n.get("name")})),alert("Perfil actualizado correctamente")}catch(n){console.error(n),alert("Error al actualizar perfil")}finally{r.disabled=!1,r.innerText=t}});const v=document.getElementById("password-form");v?.addEventListener("submit",async e=>{e.preventDefault();const r=v.querySelector("button[type=submit]"),t=r.innerText,n=document.getElementById("currentPassword").value,o=document.getElementById("newPassword").value,a=document.getElementById("confirmPassword").value;if(o!==a){alert("Las nuevas contraseñas no coinciden");return}r.disabled=!0,r.innerText="Actualizando...";try{await i.changePassword({currentPassword:n,newPassword:o}),alert("Contraseña actualizada correctamente"),v.reset()}catch(s){console.error(s),alert(s.message||"Error al actualizar la contraseña")}finally{r.disabled=!1,r.innerText=t}});function d(e){const r=document.getElementById("entrepreneurships-list");if(r){if(!e||e.length===0){r.innerHTML='<p class="text-slate-500 text-center py-4">No tienes emprendimientos registrados.</p>';return}r.innerHTML=e.map(t=>{const n=t.logoUrl||t.imageUrl||t.logo||t.image,o="http://localhost:3000";let a=null;return n&&typeof n=="string"&&n.trim()!==""&&(a=n.startsWith("http")?n:`${o}${n.startsWith("/")?"":"/"}${n}`),`
                    <div class="card h-full flex flex-col hover:border-indigo-600 transition-all hover:scale-[1.02] hover:shadow-xl" >
                    <div class="flex items-center flex-1">
                            ${a?`<img src="${a}" class="w-12 h-12 rounded-lg object-cover mr-4" />`:'<div class="w-12 h-12 rounded-lg bg-[#FAFAFA] flex items-center justify-center mr-4 shadow-sm border border-slate-100"><svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}
                            <div>
                                <h3 class="font-bold text-slate-800">${t.name}</h3>
                                <p class="text-sm text-slate-500">${t.sector}</p>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4 md:mt-0 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
                            <button 
                                class="btn-edit-ent btn btn-secondary btn-sm p-2"
                                data-id="${t.id}"
                                title="Editar Emprendimiento"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                            </button>
                            <button 
                                class="btn-image-ent btn btn-outline btn-sm p-2"
                                data-id="${t.id}"
                                title="Cambiar Imagen"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            </button>
                            <button 
                                class="btn-delete-ent btn btn-danger btn-sm bg-red-50 text-red-600 border-red-100 hover:bg-red-600 hover:text-white"
                                data-id="${t.id}"
                                data-name="${t.name}"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                `}).join(""),document.querySelectorAll(".btn-delete-ent").forEach(t=>{t.addEventListener("click",async n=>{const a=n.currentTarget.dataset.id;B("delete-entrepreneurship",a)})}),document.querySelectorAll(".btn-edit-ent").forEach(t=>{t.addEventListener("click",async n=>{const a=n.currentTarget.dataset.id;try{const s=await i.getEntrepreneurship(parseInt(a));window.dispatchEvent(new CustomEvent("open-entrepreneurship-wizard",{detail:{mode:"edit",data:s}}))}catch{alert("Error al cargar datos del emprendimiento")}})}),document.querySelectorAll(".btn-image-ent").forEach(t=>{t.addEventListener("click",n=>{const o=n.currentTarget.dataset.id,a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=async s=>{const u=s.target.files[0];if(u)try{await i.uploadImage(`/entrepreneurships/${o}/image`,u);const g=await i.getProfile();d(g.entrepreneurships)}catch{alert("Error al subir imagen")}},a.click()})})}}const m=document.getElementById("security_confirm_modal"),L=document.getElementById("security-confirm-form"),l=document.getElementById("security-password"),b=document.getElementById("security-error"),c=document.getElementById("security-submit-btn");function B(e,r){document.getElementById("security-action-type").value=e,document.getElementById("security-target-id").value=r,l.value="",b?.classList.add("hidden"),m.showModal()}L?.addEventListener("submit",async e=>{e.preventDefault();const r=document.getElementById("security-action-type").value,t=document.getElementById("security-target-id").value,n=l.value;c&&(c.innerHTML='<span class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>',c.disabled=!0);try{if(await i.verifyPassword(n),r==="delete-entrepreneurship"){await i.deleteEntrepreneurship(parseInt(t));const o=await i.getProfile();d(o.entrepreneurships)}m.close()}catch(o){console.error(o),b?.classList.remove("hidden")}finally{c&&(c.innerHTML="<span>Confirmar y Eliminar</span>",c.disabled=!1)}});document.getElementById("security-cancel-btn")?.addEventListener("click",()=>m.close());document.getElementById("btn-close-security-modal")?.addEventListener("click",()=>m.close());const h=document.getElementById("toggle-security-password"),f=h?.querySelector(".toggle-icon-show"),E=h?.querySelector(".toggle-icon-hide");h?.addEventListener("click",()=>{const e=l.getAttribute("type")==="password"?"text":"password";l.setAttribute("type",e),e==="text"?(f?.classList.add("hidden"),E?.classList.remove("hidden")):(f?.classList.remove("hidden"),E?.classList.add("hidden"))});const x=document.getElementById("btn-new-entrepreneurship");x?.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("open-entrepreneurship-wizard",{detail:{mode:"create"}}))});window.addEventListener("entrepreneurship-success",async()=>{const e=await i.getProfile();d(e.entrepreneurships)});const k=document.getElementById("avatar-container"),w=document.getElementById("avatar-input"),$=document.getElementById("cover-container"),I=document.getElementById("cover-input");k?.addEventListener("click",()=>w.click());$?.addEventListener("click",()=>I.click());w?.addEventListener("change",async e=>{const r=e.target.files[0];if(r){console.log("Uploading avatar...",r.name);try{const t=await i.uploadImage("/users/me/images",r,{type:"profile"});console.log("Avatar upload success:",t),y()}catch(t){console.error("Avatar upload failed:",t),alert("Error al subir avatar")}}});I?.addEventListener("change",async e=>{const r=e.target.files[0];if(r){console.log("Uploading cover...",r.name);try{const t=await i.uploadImage("/users/me/images",r,{type:"cover"});console.log("Cover upload success:",t),y()}catch(t){console.error("Cover upload failed:",t),alert("Error al subir portada")}}});y();
