import{api as p}from"./api.CPfjwQVw.js";import"./hoisted.Qv3mm9Uz.js";import"./Navbar.astro_astro_type_script_index_0_lang.etmQtTSB.js";import"./Sidebar.astro_astro_type_script_index_0_lang.DZqaJy4g.js";const l=document.getElementById("login-form"),i=window.AstroStatusModal["auth-status-modal"];l?.addEventListener("submit",async r=>{r.preventDefault();const o=l.querySelector('button[type="submit"]'),a=o.innerText,e=new FormData(l),t=e.get("email"),s=e.get("password"),b=e.get("remember")==="on";if(!t.trim()){i.show({title:"Campo Requerido",message:"El correo electrónico es obligatorio.",type:"warning"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){i.show({title:"Formato Inválido",message:"Ingresa un correo electrónico válido.",type:"warning"});return}if(!s){i.show({title:"Campo Requerido",message:"La contraseña es obligatoria.",type:"warning"});return}try{o.disabled=!0,o.innerText="Iniciando sesión...",await p.login({email:t,password:s},b),window.location.href="/dashboard"}catch(n){console.error("Login error:",n);let c="Error de Sesión",m=n.error||"No fue posible iniciar sesión. Intenta nuevamente.";n.error==="El correo electrónico no se encuentra registrado."?c="Correo no registrado":n.error==="La contraseña ingresada es incorrecta."?c="Contraseña Incorrecta":(n.code==="P1001"||n.code==="P1000")&&(c="Servidor No Disponible",m="La base de datos no está disponible, intenta más tarde"),i.show({title:c,message:m,type:"error"})}finally{o.disabled=!1,o.innerText=a}});const v=document.getElementById("recovery-modal"),w=document.getElementById("btn-forgot-password"),u=document.getElementById("recovery-form"),g=document.getElementById("recovery-step-1"),y=document.getElementById("recovery-step-2"),f=document.getElementById("recovery-step-error"),h=document.querySelectorAll(".btn-close-modal"),E=document.getElementById("btn-retry-recovery");w?.addEventListener("click",()=>{d(1),v.showModal()});h.forEach(r=>{r.addEventListener("click",()=>v.close())});E?.addEventListener("click",()=>{d(1)});function d(r){g?.classList.add("hidden"),y?.classList.add("hidden"),f?.classList.add("hidden"),r===1&&g?.classList.remove("hidden"),r===2&&y?.classList.remove("hidden"),r===3&&f?.classList.remove("hidden")}u?.addEventListener("submit",async r=>{r.preventDefault();const a=document.getElementById("recovery-email").value,e=u.querySelector('button[type="submit"]');if(!a.trim()){i.show({title:"Dato Requerido",message:"Por favor ingresa tu correo electrónico.",type:"warning"});return}e&&(e.disabled=!0,e.innerHTML='<span class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>');try{await p.forgotPassword(a),d(2)}catch(t){console.error("Recovery error:",t);const s=document.getElementById("recovery-error-message");s&&(s.innerText=t.error||t.message||"No fue posible enviar el correo. Intenta nuevamente."),d(3)}finally{e&&(e.disabled=!1,e.innerText="Enviar instrucciones")}});
