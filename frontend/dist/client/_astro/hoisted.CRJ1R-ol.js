import{a as f}from"./api.DUBSwrnZ.js";import"./hoisted.DbckvgP9.js";const h=window.location.pathname.split("/").pop();async function g(){try{if(!h)return;const n=await f.getPlan(parseInt(h)),t=n.entrepreneurship,a=(e,c)=>{const d=document.getElementById(e);d&&(d.innerText=c)};a("project-name",t.name),a("project-sector",t.sector),a("project-description",t.mainActivity||t.description||"Sin descripción disponible."),a("main-activity",t.mainActivity||"N/A"),a("productive-focus",t.productiveFocus||"N/A"),a("social-impact",t.socialImpact||"N/A"),a("value-proposition",t.valueProposition||"N/A"),a("differentiation",t.differentiation||"N/A"),a("customer-benefits",t.customerBenefits||"N/A");const r=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(parseFloat(e)||0);b("team-table",t.team,["Nombre","Rol","Experiencia"],["name","role","experience"]),b("partners-table",t.partners,["Nombre","Tipo","Rol"],["name","type","role"]);const l=document.getElementById("supply-chain-content");if(l)if(t.supplyChainMode==="IMAGE"&&t.supplyChainImageUrl){const e=t.supplyChainImageUrl.startsWith("http")?t.supplyChainImageUrl:`http://localhost:3000${t.supplyChainImageUrl}`;l.innerHTML=`<div class="flex flex-col items-center">
                        <img src="${e}" alt="Cadena de Suministro" class="max-w-full h-auto rounded-xl shadow-lg border border-slate-200" />
                        <p class="mt-4 text-xs text-slate-400 italic">Diagrama proporcionado por el usuario</p>
                    </div>`}else b("supply-chain-content",[{label:"Proveedores",val:t.supplyChainProviders},{label:"Producción",val:t.supplyChainProduction},{label:"Almacenamiento",val:t.supplyChainStorage},{label:"Distribución",val:t.supplyChainDistribution},{label:"Cliente Final",val:t.supplyChainClient}],["Etapa","Descripción"],["label","val"]);p("demand-table",n.demands,["Producto","Demanda Mes","Precio","Total"],e=>[e.productName,e.monthlyDemand,r(e.unitPrice),r(e.monthlyDemand*e.unitPrice)]),p("equipment-table",n.equipments,["Descripción","Cant","Precio","Fuente"],e=>[e.description,e.quantity,r(e.unitPrice),e.financingSource]),p("provisions-table",n.provisions,["Item","Unidad","Cant. Mes","Precio","Total"],e=>[e.item,e.unit,e.monthlyQuantity,r(e.unitPrice),r(e.monthlyQuantity*e.unitPrice)]),p("financing-table",n.financingItems,["Concepto","Monto","Fuente"],e=>[e.concept,r(e.amount),e.source]),E(n.projections,r),a("summary-profit",r(n.netProfit)),a("van-result",r(n.van)),a("tir-result",(parseFloat(n.tir)*100).toFixed(2)+"%"),a("bc-result",parseFloat(n.benefitCostRatio).toFixed(2)),a("payback-result",n.paybackPeriod),a("financial-conclusion",n.financialConclusion||"Sin conclusión generada."),a("rate-growth",(n.growthRate*100).toFixed(1)+"%"),a("rate-inflation",(n.inflationRate*100).toFixed(1)+"%"),a("rate-discount",(n.discountRate*100).toFixed(1)+"%");const o=document.getElementById("documents-list"),s=localStorage.getItem("token");o&&n.documents&&n.documents.length>0?(o.innerHTML=n.documents.map((e,c)=>{const d=new Date(e.createdAt).toLocaleDateString(),y=e.filePath.startsWith("http")?e.filePath:`http://localhost:3000${e.filePath}?token=${s}`;return`
                        <li class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100 hover:border-indigo-200 transition-colors">
                            <div class="flex flex-col">
                                <span class="text-xs font-bold text-slate-700">Versión #${n.documents.length-c}</span>
                                <span class="text-[10px] text-slate-400 font-medium">${d}</span>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn-delete-doc text-red-600 hover:bg-white p-1.5 rounded-lg border border-transparent hover:border-red-100 transition-all" data-id="${e.id}" title="Eliminar documento">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                </button>
                                <a href="${y}" download="plan_economico_${e.id}.docx" class="text-green-600 hover:bg-white p-1.5 rounded-lg border border-transparent hover:border-green-100 transition-all" title="Descargar">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                </a>
                            </div>
                        </li>`}).join(""),document.querySelectorAll(".btn-delete-doc").forEach(e=>{e.addEventListener("click",c=>{const y=c.currentTarget.dataset.id;w("delete-document",y)})})):o&&(o.innerHTML='<p class="text-xs text-slate-400 italic text-center py-4">No hay documentos generados aún.</p>'),document.getElementById("export-btn")?.addEventListener("click",()=>{const e=`http://localhost:3000/api/binary/plans/${h}/export?token=${s}`;window.open(e,"_blank")}),document.getElementById("loading")?.classList.add("hidden"),document.getElementById("content")?.classList.remove("hidden")}catch(n){console.error("Error loading plan:",n),document.getElementById("loading").innerHTML='<p class="text-red-500">Error al cargar datos complejos.</p>'}}function b(n,t,a,r){const l=document.getElementById(n);if(!l)return;if(!t||t.length===0){l.innerHTML='<p class="text-slate-400 text-xs italic">Sin registros.</p>';return}let o='<table class="w-full text-xs text-left"><thead class="bg-slate-50 text-slate-500 uppercase"><tr>';a.forEach(s=>o+=`<th class="px-4 py-2">${s}</th>`),o+="</tr></thead><tbody>",t.forEach(s=>{o+='<tr class="border-b border-slate-50">',r.forEach(u=>o+=`<td class="px-4 py-2 text-slate-700">${s[u]||"N/A"}</td>`),o+="</tr>"}),o+="</tbody></table>",l.innerHTML=o}function p(n,t,a,r){const l=document.getElementById(n);if(!l)return;if(!t||t.length===0){l.innerHTML='<p class="text-slate-400 text-xs italic">Sin datos registrados.</p>';return}let o='<table class="w-full text-xs text-left"><thead class="bg-slate-50 text-slate-500 uppercase"><tr>';a.forEach(s=>o+=`<th class="px-4 py-2">${s}</th>`),o+="</tr></thead><tbody>",t.forEach(s=>{o+='<tr class="border-b border-slate-50">',r(s).forEach(u=>o+=`<td class="px-4 py-2">${u}</td>`),o+="</tr>"}),o+="</tbody></table>",l.innerHTML=o}function E(n,t){const a=document.getElementById("projections-table");if(!a||!n||n.length===0)return;let r='<table class="w-full text-xs text-left"><thead class="bg-slate-100 text-slate-600 uppercase"><tr><th class="px-4 py-2">Concepto</th>';n.forEach(o=>r+=`<th class="px-4 py-2 text-center">Año ${o.year}</th>`),r+="</tr></thead><tbody>",[{label:"Ingresos",key:"revenue"},{label:"EBIT",key:"ebit"},{label:"Utilidad Neta",key:"netProfit"},{label:"Flujo Caja",key:"cashFlow",color:"text-blue-600 font-bold"}].forEach(o=>{r+=`<tr class="border-b border-slate-100"><td class="px-4 py-2 font-bold bg-slate-50">${o.label}</td>`,n.forEach(s=>r+=`<td class="px-4 py-2 text-center ${o.color||""}">${t(s[o.key])}</td>`),r+="</tr>"}),r+="</tbody></table>",a.innerHTML=r}g();const m=document.getElementById("security_confirm_modal"),I=document.getElementById("security-confirm-form"),x=document.getElementById("security-password"),v=document.getElementById("security-error"),i=document.getElementById("security-submit-btn");function w(n,t){document.getElementById("security-action-type").value=n,document.getElementById("security-target-id").value=t,x.value="",v?.classList.add("hidden"),m.showModal()}I?.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("security-action-type").value,a=document.getElementById("security-target-id").value,r=x.value;i&&(i.innerHTML='<span class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>',i.disabled=!0);try{await f.verifyPassword(r),t==="delete-document"&&(await f.deleteDocument(parseInt(a)),g()),m.close()}catch(l){console.error(l),v?.classList.remove("hidden")}finally{i&&(i.innerHTML="<span>Confirmar y Eliminar</span>",i.disabled=!1)}});document.getElementById("security-cancel-btn")?.addEventListener("click",()=>m.close());document.getElementById("btn-close-security-modal")?.addEventListener("click",()=>m.close());
