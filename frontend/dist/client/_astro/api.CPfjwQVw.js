const u="http://localhost:3000/api";class c{constructor(e){this.baseUrl=e}getToken(){return typeof window<"u"?localStorage.getItem("token")||sessionStorage.getItem("token"):null}getHeaders(){const e={"Content-Type":"application/json"},t=this.getToken();return t&&(e.Authorization=`Bearer ${t}`),e}async request(e,t={}){const r=new AbortController,s=setTimeout(()=>r.abort(),8e3),i=`${this.baseUrl}${e}`,a={...t,signal:r.signal,headers:{...this.getHeaders(),...t.headers}};try{const n=await fetch(i,a),o=await n.json();if(!n.ok)throw new Error(o.error||"Request failed");return o}catch(n){throw n.name==="AbortError"?new Error("Server not responding"):n}finally{clearTimeout(s)}}async register(e){return this.request("/auth/register",{method:"POST",body:JSON.stringify(e)})}async login(e,t=!1){const r=await this.request("/auth/login",{method:"POST",body:JSON.stringify(e)});if(r.token&&typeof window<"u"){const s=t?localStorage:sessionStorage;this.logout(),s.setItem("token",r.token),s.setItem("user",JSON.stringify(r.user))}return r}getUser(){if(typeof window<"u"){const e=localStorage.getItem("user")||sessionStorage.getItem("user");return e?JSON.parse(e):null}return null}isAuthenticated(){return!!this.getToken()}async forgotPassword(e){const t=await fetch(`${this.baseUrl}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const r=await t.json();throw new Error(r.error||"Error al solicitar recuperación")}return await t.json()}async resetPassword(e,t){const r=await fetch(`${this.baseUrl}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,password:t})});if(!r.ok){const s=await r.json();throw new Error(s.error||"Error al restablecer contraseña")}return await r.json()}logout(){typeof window<"u"&&(localStorage.removeItem("token"),localStorage.removeItem("user"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user"))}async verifyPassword(e){return this.request("/auth/verify-password",{method:"POST",body:JSON.stringify({password:e})})}async getProfile(){return this.request("/users/me")}async updateProfile(e){return this.request("/users/me",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/users/me/password",{method:"PUT",body:JSON.stringify(e)})}async createEntrepreneurship(e){return this.request("/entrepreneurships",{method:"POST",body:JSON.stringify(e)})}async getEntrepreneurships(){return this.request("/entrepreneurships")}async getEntrepreneurship(e){return this.request(`/entrepreneurships/${e}`)}async updateEntrepreneurship(e,t){return this.request(`/entrepreneurships/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteEntrepreneurship(e){return this.request(`/entrepreneurships/${e}`,{method:"DELETE"})}async createPlan(e){return this.request("/plans",{method:"POST",body:JSON.stringify(e)})}async getPlans(){return this.request("/plans")}async getPlan(e){return this.request(`/plans/${e}`)}async updatePlan(e,t){return this.request(`/plans/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deletePlan(e){return this.request(`/plans/${e}`,{method:"DELETE"})}async deleteDocument(e){return this.request(`/documents/${e}`,{method:"DELETE"})}async exportPlan(e){const t=this.getToken(),r=`${this.baseUrl}/plans/${e}/export`,i=await(await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).arrayBuffer(),a=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),n=window.URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download="plan_economico.docx",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}async uploadImage(e,t,r={}){const s=new FormData;r.type&&s.append("type",r.type),s.append("image",t);const i=this.getToken(),a=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{...i&&{Authorization:`Bearer ${i}`}},body:s});if(!a.ok){const n=await a.json().catch(()=>({error:"Error in upload"}));throw new Error(n.error||"Error in upload")}return a.json()}}const h=new c(u);export{h as api,h as default};
