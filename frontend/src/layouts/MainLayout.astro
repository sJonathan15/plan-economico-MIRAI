---
interface Props {
  title: string;
  layoutMode?: "default" | "app";
  bgClass?: string;
}

const { title, layoutMode = "default", bgClass = "" } = Astro.props;
import Sidebar from "../components/Sidebar.astro";
import "../styles/global.css";
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link
      rel="icon"
      type="image/png"
      href="/images/Logo_MIRAI_blanco_sinf.png"
    />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Plan Econ√≥mico</title>
    <script is:inline>
      // Apply sidebar state and check authentication as early as possible
      (function () {
        const token =
          localStorage.getItem("token") || sessionStorage.getItem("token");
        const path = window.location.pathname;
        const isPublic = ["/", "/login", "/register"].includes(path);

        if (token && isPublic) {
          window.location.href = "/dashboard";
        } else if (!token && !isPublic && path.startsWith("/dashboard")) {
          // This shouldn't normally happen in MainLayout unless it's used for protected pages
          window.location.href = "/login";
        }

        const collapsed = localStorage.getItem("sidebar-collapsed") === "true";
        if (collapsed) {
          document.documentElement.classList.add("sidebar-collapsed");
        }
      })();
    </script>
  </head>
  <body class="bg-[#E6EBF2]">
    {
      layoutMode === "app" ? (
        <div class="flex min-h-screen">
          <Sidebar />
          <main
            class={`flex-1 transition-all duration-300 app-main-container h-screen overflow-y-auto custom-scrollbar ${bgClass}`}
          >
            <div class="p-4 md:p-4 pb-20">
              <slot />
            </div>
          </main>
        </div>
      ) : (
        <div class={`${bgClass} min-h-screen`}>
          <slot />
        </div>
      )
    }
  </body>
</html>

<style is:global>
  :root {
    --primary-50: #f0f9ff;
    --primary-100: #e0f2fe;
    --primary-200: #bae6fd;
    --primary-300: #7dd3fc;
    --primary-400: #38bdf8;
    --primary-500: #0ea5e9;
    --primary-600: #0284c7;
    --primary-700: #0369a1;
    --primary-800: #075985;
    --primary-900: #0c4a6e;
  }

  .container-custom {
    @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
  }
</style>
